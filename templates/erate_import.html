<!DOCTYPE html>
<html>
<head>
    <title>E-Rate Import</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f4f7f9; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a5d57; }
        .progress { text-align: center; font-size: 1.2em; margin: 20px 0; }
        .record { background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn:hover { opacity: 0.9; }
        .form-group { margin: 15px 0; text-align: center; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <h1>E-Rate Interactive Import</h1>

    <div class="progress">
        Progress: <strong>{{ progress.index }}</strong> / <strong>{{ progress.total }}</strong>
        | Success: <strong style="color:green">{{ progress.success }}</strong>
        | Errors: <strong style="color:red">{{ progress.error }}</strong>
    </div>

    {% if progress.index > progress.total %}
        <p class="success">IMPORT COMPLETE!</p>
        <p style="text-align: center;">
            <a href="/erate/" class="btn btn-primary">Back to Dashboard</a>
        </p>
    {% else %}

        <div class="record">
            <h3>Record {{ progress.index }}</h3>
            <p><strong>App #:</strong> {{ row['Application Number'] or 'N/A' }}</p>
            <p><strong>Entity:</strong> {{ row['Billed Entity Name'] or 'N/A' }}</p>
            <p><strong>State:</strong> {{ row['Billed Entity State'] or 'N/A' }}</p>
            <p><strong>Modified:</strong> {{ row['Last Modified Date/Time'] or 'N/A' }}</p>
        </div>

        {% if success %}
            <p class="success">Imported successfully!</p>
        {% endif %}

        {% if error %}
            <p class="error">Error: {{ error }}</p>
        {% endif %}

        <!-- IMPORT THIS RECORD -->
        <div class="form-group">
            <form method="post" onsubmit="return confirm('Import this record?');">
                <input type="hidden" name="action" value="import_one">
                <button type="submit" class="btn btn-primary">Import This Record</button>
            </form>
        </div>

        <!-- IMPORT ALL REMAINING -->
        <div class="form-group">
            <form method="post" onsubmit="return confirm('Import ALL {{ progress.total - progress.index + 1 }} remaining records?');">
                <input type="hidden" name="action" value="import_all">
                <button type="submit" class="btn btn-success">
                    Import All Remaining ({{ progress.total - progress.index + 1 }})
                </button>
            </form>
        </div>

        <!-- START OVER -->
        <div class="form-group">
            <form method="post" onsubmit="return confirm('Start over from record 1?');">
                <input type="hidden" name="action" value="reset">
                <button type="submit" class="btn btn-danger">Start Over</button>
            </form>
        </div>

    {% endif %}

    <p style="text-align: center; margin-top: 30px;">
        <a href="/erate/">Back to Dashboard</a>
    </p>
</div>
</body>
</html>
